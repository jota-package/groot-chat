const _0x1715=['exports','log','67316DIfAxR','629xDtRmW','fedatario_visor','1209837SJGdnY','config','\x0a\x20\x20\x20\x20with\x20recursive\x0a\x20\x20\x20\x20datos_input\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20$1::int\x20as\x20proyecto_id_input\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$2::int\x20as\x20recepcion_id_input\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$3::int\x20as\x20file_id_input\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$4::jsonb\x20as\x20json_data\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$5::int\x20as\x20rowsxpag\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$6::int\x20as\x20pag\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20--proceso\x20el\x20json\x20para\x20tener\x20rows\x20con\x20todos\x20los\x20datos\x20necesarios\x0a\x20\x20\x20\x20json_input_pre\x20as\x20(\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20row_number()\x20over()\x20as\x20id,\x0a\x20\x20\x20\x20(indices.dato#>>\x27{indice,elemento_id}\x27)::int\x20as\x20elemento_id,\x0a\x20\x20\x20\x20(condiciones.cond#>>\x27{tipo}\x27)::int\x20as\x20tipo,\x0a\x20\x20\x20\x20condiciones.cond#>>\x27{valor}\x27as\x20valor,\x0a\x20\x20\x20\x20(condiciones.cond#>>\x27{negation}\x27)::boolean\x20as\x20negation,\x0a\x20\x20\x20\x20condiciones.cond#>>\x27{operador}\x27as\x20operador\x0a\x20\x20\x20\x20from\x20datos_input,jsonb_array_elements(datos_input.json_data)\x20as\x20indices(dato),jsonb_array_elements(dato#>\x27{condiciones}\x27)\x20as\x20condiciones(cond)\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--a√±ado\x20las\x20columnas\x20ultimo_id\x20y\x20operador_after\x0a\x20\x20\x20\x20json_input\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20a.*\x0a\x20\x20\x20\x20\x20\x20\x20\x20,max(a.id)\x20over()\x20as\x20ultimo_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,case\x20when\x20a.id=1\x20or\x20b.id\x20is\x20null\x20then\x20\x27AND\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20b.operador\x20end\x20as\x20operador_after\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20json_input_pre\x20a\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20json_input_pre\x20b\x20on\x20b.id=a.id+1\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--separo\x20el\x20muestreo\x20de\x20files\x20que\x20esten\x20dentro\x20del\x20file\x20o\x20proyecto\x20seleccionado\x20en\x20el\x20input\x0a\x20\x20\x20\x20files_muestreo_pre\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20f.*\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20datos_input\x20di\x0a\x20\x20\x20\x20\x20\x20\x20\x20cross\x20join\x20files\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20recepcion\x20r\x20on\x20r.recepcion_id\x20=\x20f.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x20f.file_id\x20=\x20di.file_id_input\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20or(\x20di.file_id_input=0\x20and\x20f.file_padre_id\x20is\x20null\x20and\x20f.file_captura_estado\x20=1\x20and\x20r.proyecto_id\x20=di.proyecto_id_input)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20union\x20all\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20f.*\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20files_muestreo_pre\x20fm\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20files\x20f\x20on\x20f.file_padre_id\x20=\x20fm.file_id\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20files_muestreo\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20f.*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,c.captura_id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,i.indizacion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20files_muestreo_pre\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20captura\x20c\x20on\x20c.captura_file_id\x20=\x20f.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20indizacion\x20i\x20on\x20i.captura_id\x20=\x20c.captura_id\x20and\x20i.indizacion_tipo\x20=\x20\x27VF\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20f.file_tipo\x20=\x20\x27f\x27\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20resultado_busqueda_pre\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.indizacion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,co.*\x0a\x20\x20\x20\x20\x20\x20\x20\x20,(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--para\x20tipo\x20de\x20dato\x20normal\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--when\x20co.tipo\x20=\x204\x20and\x20co.negation\x20is\x20false\x20then\x20(r.valor\x20ilike\x20\x27%\x27||co.valor||\x27%\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x204\x20and\x20co.negation\x20is\x20false\x20then\x20(r.valor\x20~*\x20co.valor)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--when\x20co.tipo\x20=\x204\x20and\x20co.negation\x20is\x20true\x20then\x20not\x20(r.valor\x20ilike\x20\x27%\x27||co.valor||\x27%\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x204\x20and\x20co.negation\x20is\x20true\x20then\x20not\x20(r.valor\x20~*\x20co.valor)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--para\x20tipo\x20de\x20dato\x20fecha\x20...falta\x20ajustar\x20para\x20distintos\x20tipos\x20de\x20formatos\x20de\x20fecha\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x203\x20and\x20co.negation\x20is\x20false\x20then\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x20TO_DATE(r.valor,\x27DD/MM/YYYY\x27)\x20between\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x201)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x202)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x203\x20and\x20co.negation\x20is\x20true\x20then\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20not\x20(\x20TO_DATE(r.valor,\x27DD/MM/YYYY\x27)\x20between\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x201)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x202)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20false::boolean\x20end\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20as\x20resultado_condicion\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20(select\x20*\x20from\x20json_input\x20where\x20id=1)\x20as\x20co\x0a\x20\x20\x20\x20\x20\x20\x20\x20cross\x20join\x20files_muestreo\x20f\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20respuesta\x20r\x20on\x20f.indizacion_id\x20=\x20r.indizacion_id\x20and\x20r.elemento_id\x20=\x20co.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20--resultado\x20de\x20la\x20condicion\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--para\x20tipo\x20de\x20dato\x20normal\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x204\x20and\x20co.negation\x20is\x20false\x20then\x20(r.valor\x20~*\x20co.valor)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x204\x20and\x20co.negation\x20is\x20true\x20then\x20not\x20(r.valor\x20~*\x20co.valor)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--para\x20tipo\x20de\x20dato\x20fecha\x20...falta\x20ajustar\x20para\x20distintos\x20tipos\x20de\x20formatos\x20de\x20fecha\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x203\x20and\x20co.negation\x20is\x20false\x20then\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x20TO_DATE(r.valor,\x27DD/MM/YYYY\x27)\x20between\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x201)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x202)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x203\x20and\x20co.negation\x20is\x20true\x20then\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20not\x20(\x20TO_DATE(r.valor,\x27DD/MM/YYYY\x27)\x20between\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x201)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x202)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20false::boolean\x20end\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20co.operador_after\x20=\x20\x27AND\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20or\x20co.operador_after\x20=\x20\x27OR\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20--agregamos\x20la\x20union\x20para\x20la\x20recursividad..............................................\x0a\x20\x20\x20\x20\x20\x20\x20\x20union\x20all\x0a\x20\x20\x20\x20\x20\x20\x20\x20--agregamos\x20la\x20union\x20para\x20la\x20recursividad..............................................\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.indizacion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,co.*\x0a\x20\x20\x20\x20\x20\x20\x20\x20,(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--para\x20tipo\x20de\x20dato\x20normal\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x204\x20and\x20co.negation\x20is\x20false\x20then\x20(r.valor\x20~*\x20co.valor)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x204\x20and\x20co.negation\x20is\x20true\x20then\x20not\x20(r.valor\x20~*\x20co.valor)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--para\x20tipo\x20de\x20dato\x20fecha\x20...falta\x20ajustar\x20para\x20distintos\x20tipos\x20de\x20formatos\x20de\x20fecha\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x203\x20and\x20co.negation\x20is\x20false\x20then\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x20TO_DATE(r.valor,\x27DD/MM/YYYY\x27)\x20between\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x201)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x202)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x203\x20and\x20co.negation\x20is\x20true\x20then\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20not\x20(\x20TO_DATE(r.valor,\x27DD/MM/YYYY\x27)\x20between\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x201)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x202)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20false::boolean\x20end\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x20as\x20resultado_condicion\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20(select\x20*\x20from\x20resultado_busqueda_pre\x20where\x20not\x20(resultado_condicion\x20is\x20true\x20and\x20operador_after\x20=\x27OR\x27\x20))\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20json_input\x20co\x20on\x20co.id=f.id+1\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20respuesta\x20r\x20on\x20f.indizacion_id\x20=\x20r.indizacion_id\x20and\x20r.elemento_id\x20=\x20co.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20--resultado\x20de\x20la\x20condicion\x0a\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--para\x20tipo\x20de\x20dato\x20normal\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x204\x20and\x20co.negation\x20is\x20false\x20then\x20(r.valor\x20~*\x20co.valor)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x204\x20and\x20co.negation\x20is\x20true\x20then\x20not\x20(r.valor\x20~*\x20co.valor)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--para\x20tipo\x20de\x20dato\x20fecha\x20...falta\x20ajustar\x20para\x20distintos\x20tipos\x20de\x20formatos\x20de\x20fecha\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x203\x20and\x20co.negation\x20is\x20false\x20then\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x20TO_DATE(r.valor,\x27DD/MM/YYYY\x27)\x20between\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x201)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x202)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20co.tipo\x20=\x203\x20and\x20co.negation\x20is\x20true\x20then\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20not\x20(\x20TO_DATE(r.valor,\x27DD/MM/YYYY\x27)\x20between\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x201)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20TO_DATE(split_part(co.valor,\x20\x27\x20-\x20\x27,\x202)\x20,\x27DD/MM/YYYY\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20false::boolean\x20end\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20co.operador_after\x20=\x20\x27AND\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20or\x20co.operador_after\x20=\x20\x27OR\x27\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--filtro\x20final\x20del\x20resultado\x0a\x20\x20\x20\x20resultado_busqueda\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20r.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(r.file_id)\x20over()\x20as\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20resultado_busqueda_pre\x20r\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20r.resultado_condicion\x20is\x20true\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20(r.id\x20=\x20r.ultimo_id\x20or\x20r.operador_after\x20=\x20\x27OR\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20order\x20by\x20r.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20(select\x20rowsxpag\x20from\x20datos_input)\x0a\x20\x20\x20\x20\x20\x20\x20\x20OFFSET\x20(((select\x20pag\x20from\x20datos_input)-1)\x20*\x20(select\x20rowsxpag\x20from\x20datos_input))\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--select\x20*\x20from\x20resultado_busqueda;\x0a\x20\x20\x20\x20files_r\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20row_number()\x20over(order\x20by\x20r.file_id)\x20as\x20id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20di.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20false\x20as\x20coincidencia_contenido,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27\x27\x20as\x20pagina,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27\x27\x20as\x20linea,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27ba\x27\x20as\x20tipo_busqueda,\x0a\x20\x20\x20\x20\x20\x20\x20\x20r.total\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20resultado_busqueda\x20r\x0a\x20\x20\x20\x20\x20\x20\x20\x20cross\x20join\x20datos_input\x20di\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20files_muestreo\x20f\x20on\x20f.file_id\x20=\x20r.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20order\x20by\x20r.file_id\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--consigo\x20la\x20cantidad\x20de\x20paginas\x20de\x20cada\x20documento\x0a\x20\x20\x20\x20paginas\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--select\x200\x20as\x20captura_id,0\x20as\x20captura_file_id,0\x20as\x20cant_paginas\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20c.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,c.captura_file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,count(b.imagen_id)\x20as\x20cant_paginas\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20files_r\x20a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20captura\x20c\x20on\x20c.captura_file_id\x20=\x20a.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20imagen\x20b\x20on\x20b.captura_id\x20=\x20c.captura_id\x20and\x20b.imagen_estado\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x20c.captura_id,c.captura_file_id\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20cabecera\x20AS(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20--distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pro.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20re.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--fi.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20when\x20fi.file_captura_estado\x20!=\x201\x20then\x20fi.recepcion_id*-1000\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20fi.file_padre_id\x20end\x20as\x20file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20doc.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pla.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_url\x20,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_peso\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,p.persona_nombre||\x27\x20\x27||p.persona_apellido\x20as\x20usuario_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,to_char(ca.created_at,\x27DD/MM/YYYY\x20-\x20HH24:MI:SS\x27)\x20as\x20created_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.coincidencia_contenido\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.pagina\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.linea\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20proyecto\x20pro\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20plantilla\x20pla\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pla.plantilla_id=\x20pro.plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20recepcion\x20re\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pro.proyecto_id=\x20re.proyecto_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--join\x20files_final\x20fi\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20files_r\x20fi\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20fi.recepcion_id\x20=\x20re.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20captura\x20\x20ca\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.captura_file_id\x20=\x20fi.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20documento\x20doc\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20doc.captura_id=\x20ca.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20adetalle\x20ad\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ad.adetalle_id\x20=\x20doc.adetalle_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--join\x20para\x20obtener\x20el\x20nombre\x20del\x20usuario\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20persona\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.usuario_creador\x20=\x20p.usuario_id\x0a\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos_pre\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20--distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20when\x20res.respuesta_id\x20is\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20json_build_object(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27respuesta_id\x27,\x20res.respuesta_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27opcion_id\x27,\x20res.opcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27combo_id\x27,\x20res.combo_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_id\x27,\x20res.elemento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_tipo\x27,\x20res.elemento_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27plantilla_id\x27,\x20res.plantilla_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27valor\x27,\x20res.valor,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27indizacion_id\x27,\x20res.indizacion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27conca_id\x27,\x20res.conca_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27simple_tipo_dato\x27,\x20s.simple_tipo_dato,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27simple_tipo_formato\x27,\x20s.simple_tipo_formato,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_nombre\x27,\x20e.elemento_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27opcion_nombre\x27,\x20o.opcion_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20end\x20as\x20item\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--over\x20(partition\x20by\x20ca.file_id)\x20AS\x20items\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--,ca.children\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.coincidencia_contenido\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.pagina\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.linea\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20cabecera\x20ca\x20\x20left\x20join\x20indizacion\x20ind\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.captura_id\x20=\x20ind.captura_id\x20and\x20ind.indizacion_tipo\x20=\x27VF\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x20respuesta\x20res\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20res.indizacion_id\x20=\x20ind.indizacion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20elemento\x20e\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20e.elemento_id\x20=\x20res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20simple\x20s\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20s.elemento_id\x20=\x20res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20opcion\x20o\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20o.opcion_id\x20=\x20res.opcion_id\x20\x20\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a.item\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20over(partition\x20by\x20a.file_id)\x0a\x20\x20\x20\x20\x20\x20\x20\x20as\x20items\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.coincidencia_contenido\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.pagina\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.linea\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.total\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20*\x20from\x20datos_pre\x20order\x20by\x20file_id,tipo_busqueda,id,elemento_id)\x20a\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos2\x20as\x20(\x0a\x20\x20\x20\x20select\x20--distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20case\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20ca.items\x20=\x20\x27[null]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20\x27[]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.items\x0a\x20\x20\x20\x20\x20\x20\x20\x20end\x20as\x20items,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27/\x27||gmd.gmd_nombre||\x27/\x27||gmrd.gmrd_ruta||ca.adetalle_nombre\x20as\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20-----\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/json/\x27||gmd.gmd_nombre||\x27/\x27||replace(ca.adetalle_nombre,\x27.pdf\x27,\x27.json\x27)\x20as\x20file_content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27[]\x27::jsonb\x20AS\x20ruta\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,ca.children\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20case\x20when\x20pa.captura_id\x20is\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20pa.cant_paginas\x20end\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20p.plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.total\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.coincidencia_contenido\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.pagina\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.linea\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20datos\x20ca\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20proyecto\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20p.proyecto_id\x20=\x20ca.proyecto_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_ruta_destino\x20gmrd\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmrd.captura_estado\x20=\x20ca.captura_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_detalle_captura\x20gmdc\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmdc.captura_id\x20=\x20ca.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_detalle\x20gmd\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmd.gmd_id\x20=\x20gmdc.gmd_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20paginas\x20pa\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pa.captura_id=gmdc.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20order\x20by\x20ca.file_id\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/recepcion_\x27||(recepcion_id::varchar(10))||\x27.json\x27\x20as\x20file_data,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20items,\x0a\x20\x20\x20\x20\x20\x20\x20\x20adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20--children,\x0a\x20\x20\x20\x20case\x0a\x20\x20\x20\x20\x20\x20\x20\x20when\x20ruta\x20=\x20\x27[null]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20\x27[]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ruta\x0a\x20\x20\x20\x20end\x20as\x20ruta\x0a\x20\x20\x20\x20\x20\x20\x20\x20,cant_paginas\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x27database/plantilla_\x27||(plantilla_id::varchar(10))||\x27.json\x27\x20as\x20plantilla_file\x0a\x20\x20\x20\x20\x20\x20\x20\x20,total\x0a\x20\x20\x20\x20\x20\x20\x20\x20,id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,coincidencia_contenido\x0a\x20\x20\x20\x20\x20\x20\x20\x20,pagina\x0a\x20\x20\x20\x20\x20\x20\x20\x20,linea\x0a\x20\x20\x20\x20\x20\x20\x20\x20,tipo_busqueda\x0a\x20\x20\x20\x20from\x20datos2\x0a\x20\x20\x20\x20;\x0a\x20\x20\x20\x20','localhost','contenidoFile','busquedaAvanzada','1npEnil','DB_PASSWORD','25TbXruV','\x0a\x20\x20\x20\x20with\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20files_final\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20--archivos\x20caso\x20normal\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_tipo\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,f.file_padre_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,case\x20when\x20f.file_captura_estado\x20!=\x201\x20then\x20f.recepcion_id*-1000\x0a\x20\x20\x20\x20\x20\x20\x20\x20else\x20f.file_padre_id\x20end\x20as\x20file_padre_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_captura_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_usuario_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.created_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.updated_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20files\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20captura\x20b\x20\x20on\x20f.file_id\x20=\x20b.captura_file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20f.file_id\x20=\x20$1\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20cabecera\x20AS(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pro.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20re.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20doc.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pla.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_url\x20,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_peso\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,p.persona_nombre||\x27\x20\x27||p.persona_apellido\x20as\x20usuario_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,to_char(ca.created_at,\x27DD/MM/YYYY\x20-\x20HH24:MI:SS\x27)\x20as\x20created_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20proyecto\x20pro\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20plantilla\x20pla\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pla.plantilla_id=\x20pro.plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20recepcion\x20re\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pro.proyecto_id=\x20re.proyecto_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20files_final\x20fi\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20fi.recepcion_id\x20=\x20re.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20captura\x20\x20ca\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.captura_file_id\x20=\x20fi.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20documento\x20doc\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20doc.captura_id=\x20ca.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20adetalle\x20ad\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ad.adetalle_id\x20=\x20doc.adetalle_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--join\x20para\x20obtener\x20el\x20nombre\x20del\x20usuario\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20persona\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.usuario_creador\x20=\x20p.usuario_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos_pre\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20when\x20res.respuesta_id\x20is\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20json_build_object(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27respuesta_id\x27,\x20res.respuesta_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27opcion_id\x27,\x20res.opcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27combo_id\x27,\x20res.combo_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_id\x27,\x20res.elemento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_tipo\x27,\x20res.elemento_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27plantilla_id\x27,\x20res.plantilla_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27valor\x27,\x20res.valor,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27indizacion_id\x27,\x20res.indizacion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27conca_id\x27,\x20res.conca_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27simple_tipo_dato\x27,\x20s.simple_tipo_dato,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27simple_tipo_formato\x27,\x20s.simple_tipo_formato,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_nombre\x27,\x20e.elemento_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27opcion_nombre\x27,\x20o.opcion_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20end\x20as\x20item\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20cabecera\x20ca\x20\x20left\x20join\x20indizacion\x20ind\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.captura_id\x20=\x20ind.captura_id\x20and\x20ind.indizacion_tipo\x20=\x27VF\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x20respuesta\x20res\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20res.indizacion_id\x20=\x20ind.indizacion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20elemento\x20e\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20e.elemento_id\x20=\x20res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20simple\x20s\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20s.elemento_id\x20=\x20res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20opcion\x20o\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20o.opcion_id\x20=\x20res.opcion_id\x20\x20\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a.item\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20over(partition\x20by\x20a.file_id)\x0a\x20\x20\x20\x20\x20\x20\x20\x20as\x20items\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20*\x20from\x20datos_pre\x20order\x20by\x20file_id,elemento_id)\x20a\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos2\x20as\x20(\x0a\x20\x20\x20\x20select\x20--distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20case\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20ca.items\x20=\x20\x27[null]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20\x27[]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.items\x0a\x20\x20\x20\x20\x20\x20\x20\x20end\x20as\x20items,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27/\x27||gmd.gmd_nombre||\x27/\x27||gmrd.gmrd_ruta||ca.adetalle_nombre\x20as\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/json/\x27||gmd.gmd_nombre||\x27/\x27||replace(ca.adetalle_nombre,\x27.pdf\x27,\x27.json\x27)\x20as\x20file_content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_peso\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20p.plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20datos\x20ca\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20proyecto\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20p.proyecto_id\x20=\x20ca.proyecto_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_ruta_destino\x20gmrd\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmrd.captura_estado\x20=\x20ca.captura_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_detalle_captura\x20gmdc\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmdc.captura_id\x20=\x20ca.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_detalle\x20gmd\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmd.gmd_id\x20=\x20gmdc.gmd_id\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/recepcion_\x27||(recepcion_id::varchar(10))||\x27.json\x27\x20as\x20file_data,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20items,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/plantilla_\x27||(plantilla_id::varchar(10))||\x27.json\x27\x20as\x20plantilla_file\x0a\x20\x20\x20\x20from\x20datos2\x0a\x20\x20\x20\x20;\x0a\x20\x20\x20\x20','DB_DATABASE','dotenv','contenidoDirectorio','../Controllers/respuesta','832mnritk','526998SBIVqR','postgres','No\x20se\x20ha\x20establedico\x20una\x20conexion\x20con\x20la\x20base\x20de\x20datos.','\x0a\x20\x20\x20\x20with\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20files_final\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20--archivos\x20caso\x20normal\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_tipo\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,f.file_padre_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,case\x20when\x20f.file_captura_estado\x20!=\x201\x20then\x20f.recepcion_id*-1000\x0a\x20\x20\x20\x20\x20\x20\x20\x20else\x20f.file_padre_id\x20end\x20as\x20file_padre_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_captura_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_usuario_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.created_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.updated_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20files\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20captura\x20b\x20\x20on\x20f.file_id\x20=\x20b.captura_file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20f.file_id\x20=\x20ANY($1::int[])\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20cabecera\x20AS(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pro.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20re.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20doc.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pla.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_url\x20,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_peso\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,p.persona_nombre||\x27\x20\x27||p.persona_apellido\x20as\x20usuario_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,to_char(ca.created_at,\x27DD/MM/YYYY\x20-\x20HH24:MI:SS\x27)\x20as\x20created_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20proyecto\x20pro\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20plantilla\x20pla\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pla.plantilla_id=\x20pro.plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20recepcion\x20re\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pro.proyecto_id=\x20re.proyecto_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20files_final\x20fi\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20fi.recepcion_id\x20=\x20re.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20captura\x20\x20ca\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.captura_file_id\x20=\x20fi.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20documento\x20doc\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20doc.captura_id=\x20ca.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20adetalle\x20ad\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ad.adetalle_id\x20=\x20doc.adetalle_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--join\x20para\x20obtener\x20el\x20nombre\x20del\x20usuario\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20persona\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.usuario_creador\x20=\x20p.usuario_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos_pre\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20when\x20res.respuesta_id\x20is\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20json_build_object(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27respuesta_id\x27,\x20res.respuesta_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27opcion_id\x27,\x20res.opcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27combo_id\x27,\x20res.combo_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_id\x27,\x20res.elemento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_tipo\x27,\x20res.elemento_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27plantilla_id\x27,\x20res.plantilla_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27valor\x27,\x20res.valor,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27indizacion_id\x27,\x20res.indizacion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27conca_id\x27,\x20res.conca_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27simple_tipo_dato\x27,\x20s.simple_tipo_dato,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27simple_tipo_formato\x27,\x20s.simple_tipo_formato,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_nombre\x27,\x20e.elemento_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27opcion_nombre\x27,\x20o.opcion_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20end\x20as\x20item\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20cabecera\x20ca\x20\x20left\x20join\x20indizacion\x20ind\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.captura_id\x20=\x20ind.captura_id\x20and\x20ind.indizacion_tipo\x20=\x27VF\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x20respuesta\x20res\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20res.indizacion_id\x20=\x20ind.indizacion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20elemento\x20e\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20e.elemento_id\x20=\x20res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20simple\x20s\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20s.elemento_id\x20=\x20res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20opcion\x20o\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20o.opcion_id\x20=\x20res.opcion_id\x20\x20\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a.item\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20over(partition\x20by\x20a.file_id)\x0a\x20\x20\x20\x20\x20\x20\x20\x20as\x20items\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20*\x20from\x20datos_pre\x20order\x20by\x20file_id,elemento_id)\x20a\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos2\x20as\x20(\x0a\x20\x20\x20\x20select\x20--distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20case\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20ca.items\x20=\x20\x27[null]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20\x27[]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.items\x0a\x20\x20\x20\x20\x20\x20\x20\x20end\x20as\x20items,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27/\x27||gmd.gmd_nombre||\x27/\x27||gmrd.gmrd_ruta||ca.adetalle_nombre\x20as\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/json/\x27||gmd.gmd_nombre||\x27/\x27||replace(ca.adetalle_nombre,\x27.pdf\x27,\x27.json\x27)\x20as\x20file_content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_peso\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20p.plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20datos\x20ca\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20proyecto\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20p.proyecto_id\x20=\x20ca.proyecto_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_ruta_destino\x20gmrd\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmrd.captura_estado\x20=\x20ca.captura_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_detalle_captura\x20gmdc\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmdc.captura_id\x20=\x20ca.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_detalle\x20gmd\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmd.gmd_id\x20=\x20gmdc.gmd_id\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/recepcion_\x27||(recepcion_id::varchar(10))||\x27.json\x27\x20as\x20file_data,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20items,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/plantilla_\x27||(plantilla_id::varchar(10))||\x27.json\x27\x20as\x20plantilla_file\x0a\x20\x20\x20\x20from\x20datos2\x0a\x20\x20\x20\x20;\x0a\x20\x20\x20\x20','error','Ocurrio\x20un\x20error\x20inesperado.','DB_HOST','\x0a\x20\x20\x20\x20','busquedaSimple','2109zFBzGp','function','listarFilesContenido','1477520xSahFb','env','279ALXMiR','428204MyiIWJ','Hubo\x20un\x20error\x20en\x20la\x20consulta','DB_PORT','5432'];const _0x3702=function(_0x38d079,_0x1a052d){_0x38d079=_0x38d079-0x1dd;let _0x17152c=_0x1715[_0x38d079];return _0x17152c;};const _0xa52ab4=_0x3702;(function(_0x475398,_0x5a3753){const _0x1f55c3=_0x3702;while(!![]){try{const _0x177cb1=parseInt(_0x1f55c3(0x1ee))*parseInt(_0x1f55c3(0x203))+parseInt(_0x1f55c3(0x1f7))+parseInt(_0x1f55c3(0x1e8))+-parseInt(_0x1f55c3(0x1e5))*parseInt(_0x1f55c3(0x1f0))+-parseInt(_0x1f55c3(0x1e6))*parseInt(_0x1f55c3(0x200))+parseInt(_0x1f55c3(0x1f6))*parseInt(_0x1f55c3(0x1de))+parseInt(_0x1f55c3(0x1df));if(_0x177cb1===_0x5a3753)break;else _0x475398['push'](_0x475398['shift']());}catch(_0x3f5561){_0x475398['push'](_0x475398['shift']());}}}(_0x1715,0xd33ca));const {Pool}=require('pg'),respuesta=require(_0xa52ab4(0x1f5));require(_0xa52ab4(0x1f3))[_0xa52ab4(0x1e9)]();const pool=new Pool({'host':process[_0xa52ab4(0x1dd)][_0xa52ab4(0x1fd)]||_0xa52ab4(0x1eb),'user':process['env']['DB_USERNAME']||_0xa52ab4(0x1f8),'password':process[_0xa52ab4(0x1dd)][_0xa52ab4(0x1ef)]||_0xa52ab4(0x1f8),'database':process['env'][_0xa52ab4(0x1f2)]||_0xa52ab4(0x1e7),'port':process[_0xa52ab4(0x1dd)][_0xa52ab4(0x1e1)]||_0xa52ab4(0x1e2)});let tablaModel={};tablaModel[_0xa52ab4(0x1f4)]=(_0x2a0ce8,_0xfb3bad)=>{const _0x1a5fe7=_0xa52ab4;let {file_id:_0x400efe,recepcion_id:_0x225160,rows:_0x427096,page:_0x22da2b}=_0x2a0ce8;general_query(querys[_0x1a5fe7(0x1f4)],[_0x400efe,_0x427096,_0x22da2b,_0x225160],_0xfb3bad);},tablaModel[_0xa52ab4(0x1ec)]=(_0x5d40d6,_0x1257a9)=>{const _0x1f2025=_0xa52ab4;let {file_id:_0x393eaf}=_0x5d40d6;general_query(querys[_0x1f2025(0x1ec)],[_0x393eaf],_0x1257a9);},tablaModel['busquedaSimple']=(_0x2090f6,_0x909f16)=>{const _0x20b5dd=_0xa52ab4;let {proyecto_id:_0x247652,recepcion_id:_0x257a6c,file_id:_0x1a80a6,busqueda:_0x1af1a9,carpeta:_0x57402e,documento:_0x280b57,indices:_0x543d35,visor:_0x2781ce,rows:_0x13fbd9,page:_0x3f7e4c}=_0x2090f6;general_query(querys[_0x20b5dd(0x1ff)],[_0x247652,_0x257a6c,_0x1a80a6,_0x1af1a9,_0x57402e,_0x280b57,_0x543d35,_0x2781ce,_0x13fbd9,_0x3f7e4c],_0x909f16);},tablaModel[_0xa52ab4(0x1ed)]=(_0x2fef1c,_0x2c1929)=>{const _0x395f8a=_0xa52ab4;let {proyecto_id:_0x5827b7,recepcion_id:_0x13f312,file_id:_0x1875fc,condiciones:_0x4768f0,rows:_0x3b8599,page:_0x59284d}=_0x2fef1c;general_query(querys[_0x395f8a(0x1ed)],[_0x5827b7,_0x13f312,_0x1875fc,_0x4768f0,_0x3b8599,_0x59284d],_0x2c1929);},tablaModel[_0xa52ab4(0x202)]=(_0x28e40c,_0x593135)=>{const _0x2ede4b=_0xa52ab4;let {lista:_0x4932b2}=_0x28e40c;general_query(querys[_0x2ede4b(0x202)],[_0x4932b2],_0x593135);},module[_0xa52ab4(0x1e3)]=tablaModel;let general_query=(_0x2d0a24,_0x515999,_0x191c78)=>{const _0x4ad01=_0xa52ab4;if(pool)try{console[_0x4ad01(0x1e4)](_0x515999),pool['query'](_0x2d0a24,_0x515999,(_0x110645,_0x21b8e4)=>{const _0x3a77db=_0x4ad01;_0x110645?(console['log'](_0x110645),typeof _0x191c78=='function'&&_0x191c78(respuesta[_0x3a77db(0x1fb)](_0x3a77db(0x1e0)))):(console['log'](_0x21b8e4),typeof _0x191c78==_0x3a77db(0x201)&&_0x191c78(respuesta['ok'](_0x21b8e4)));});}catch(_0x20cd0e){console[_0x4ad01(0x1e4)](_0x20cd0e),typeof _0x191c78==_0x4ad01(0x201)&&_0x191c78(respuesta[_0x4ad01(0x1fb)](_0x4ad01(0x1fc)));}else _0x191c78(respuesta[_0x4ad01(0x1fb)](_0x4ad01(0x1f9)));};const querys={'testo':_0xa52ab4(0x1fe),'contenidoDirectorio':'with\x20\x0apaginas\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,c.captura_file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,count(b.imagen_id)\x20as\x20cant_paginas\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20files\x20a\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20captura\x20c\x20on\x20c.captura_file_id\x20=\x20a.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20imagen\x20b\x20on\x20b.captura_id\x20=\x20c.captura_id\x20and\x20b.imagen_estado\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20------------------------------------------------------------------------\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20a.file_padre_id\x20=\x20$1\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--agregado\x20para\x20calibradoras\x20y\x20aperturas\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20or\x20a.recepcion_id\x20=\x20\x20$1/(-1000)\x0a\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x20c.captura_id,c.captura_file_id\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20files_filtrado\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20--archivos\x20caso\x20normal\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_tipo\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,f.file_padre_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,case\x20when\x20f.file_captura_estado\x20!=\x201\x20then\x20f.recepcion_id*-1000\x0a\x20\x20\x20\x20\x20\x20\x20\x20else\x20f.file_padre_id\x20end\x20as\x20file_padre_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_captura_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_usuario_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.created_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.updated_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,p.cant_paginas\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20files\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20captura\x20b\x20\x20on\x20f.file_id\x20=\x20b.captura_file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20--para\x20cantidad\x20de\x20imagenes\x0a\x20\x20\x20\x20\x20\x20\x20\x20--left\x20join\x20paginas\x20p\x20on\x20p.captura_id\x20=\x20a.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20--where\x20a.gmd_id\x20=\x2013----------------------\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20f.file_padre_id\x20=\x20$1\x0a\x20\x20\x20\x20\x20\x20\x20\x20or\x20(\x270\x27=$1::varchar(10)\x20and\x20f.recepcion_id\x20=\x20$4\x20and\x20f.file_padre_id\x20is\x20null\x20and\x20f.file_captura_estado\x20=\x201)\x0a\x20\x20\x20\x20\x20\x20\x20\x20------------------------------------------------------------------------------------\x0a\x20\x20\x20\x20\x20\x20\x20\x20union\x20all\x0a\x20\x20\x20\x20\x20\x20\x20\x20--archivos\x20caso\x20click\x20en\x20carpeta\x20ACTA\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_tipo\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,f.file_padre_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,case\x20when\x20f.file_captura_estado\x20!=\x201\x20then\x20f.recepcion_id*-1000\x0a\x20\x20\x20\x20\x20\x20\x20\x20else\x20f.file_padre_id\x20end\x20as\x20file_padre_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_captura_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.file_usuario_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.created_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20,f.updated_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20files\x20f\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20f.file_captura_estado\x20!=\x201\x20and\x20f.recepcion_id\x20=\x20$1/(-1000)\x0a\x20\x20\x20\x20\x20\x20\x20\x20--------------------------------------------------------------------------------------\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20files_final\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20distinct\x20*\x20from\x20files_filtrado\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20union\x20all\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a.recepcion_id*-1000,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27CALIBRADORAS\x20Y\x20ACTAS\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27d\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20null::int,--a.recepcion_id*-1,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20now(),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20now()\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--,0\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20recepcion\x20a\x0a\x20\x20\x20\x20\x20\x20\x20\x20--left\x20join\x20recepcion\x20b\x20on\x20a.recepcion_id\x20=\x20b.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20a.recepcion_id\x20=\x20$4\x20and\x20\x270\x27=\x20$1::varchar(10)\x0a\x20\x20\x20\x20\x20\x20\x20\x20-------------------------------------------------------------------------------------\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20cabecera\x20AS(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pro.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20re.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20doc.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pla.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_url\x20,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_peso\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,p.persona_nombre||\x27\x20\x27||p.persona_apellido\x20as\x20usuario_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,to_char(ca.created_at,\x27DD/MM/YYYY\x20-\x20HH24:MI:SS\x27)\x20as\x20created_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20proyecto\x20pro\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20plantilla\x20pla\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pla.plantilla_id=\x20pro.plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20recepcion\x20re\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pro.proyecto_id=\x20re.proyecto_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20files_final\x20fi\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20fi.recepcion_id\x20=\x20re.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20captura\x20\x20ca\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.captura_file_id\x20=\x20fi.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20documento\x20doc\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20doc.captura_id=\x20ca.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20adetalle\x20ad\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ad.adetalle_id\x20=\x20doc.adetalle_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--join\x20para\x20obtener\x20el\x20nombre\x20del\x20usuario\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20persona\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.usuario_creador\x20=\x20p.usuario_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos_pre\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20when\x20res.respuesta_id\x20is\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20json_build_object(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27respuesta_id\x27,\x20res.respuesta_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27opcion_id\x27,\x20res.opcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27combo_id\x27,\x20res.combo_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_id\x27,\x20res.elemento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_tipo\x27,\x20res.elemento_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27plantilla_id\x27,\x20res.plantilla_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27valor\x27,\x20res.valor,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27indizacion_id\x27,\x20res.indizacion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27conca_id\x27,\x20res.conca_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27simple_tipo_dato\x27,\x20s.simple_tipo_dato,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27simple_tipo_formato\x27,\x20s.simple_tipo_formato,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_nombre\x27,\x20e.elemento_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27opcion_nombre\x27,\x20o.opcion_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20end\x20as\x20item\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--over\x20(partition\x20by\x20ca.file_id)\x20AS\x20items\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--,ca.children\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20cabecera\x20ca\x20\x20left\x20join\x20indizacion\x20ind\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.captura_id\x20=\x20ind.captura_id\x20and\x20ind.indizacion_tipo\x20=\x27VF\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x20respuesta\x20res\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20res.indizacion_id\x20=\x20ind.indizacion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20elemento\x20e\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20e.elemento_id\x20=\x20res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20simple\x20s\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20s.elemento_id\x20=\x20res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20opcion\x20o\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20o.opcion_id\x20=\x20res.opcion_id\x20\x20\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a.item\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20over(partition\x20by\x20a.file_id)\x0a\x20\x20\x20\x20\x20\x20\x20\x20as\x20items\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,a.children\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20*\x20from\x20datos_pre\x20order\x20by\x20file_id,elemento_id)\x20a\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos2\x20as\x20(\x0a\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20case\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20ca.items\x20=\x20\x27[null]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20\x27[]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.items\x0a\x20\x20\x20\x20\x20\x20\x20\x20end\x20as\x20items,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20--ca.adetalle_url\x20as\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20--p.proyecto_nombre||\x27/\x27||gmd.gmd_nombre||\x0a\x20\x20\x20\x20\x20\x20\x20\x20--\x27/\x27||gmrd.gmrd_ruta||ca.adetalle_nombre\x20as\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27/\x27||gmd.gmd_nombre||\x27/\x27||gmrd.gmrd_ruta||ca.adetalle_nombre\x20as\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20-----\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/json/\x27||gmd.gmd_nombre||\x27/\x27||replace(ca.adetalle_nombre,\x27.pdf\x27,\x27.json\x27)\x20as\x20file_content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x0a\x20\x20\x20\x20\x20\x20\x20\x20jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--im.imagen_url\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--p.proyecto_nombre||\x27/\x27||gmd.gmd_nombre||\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27/visor/componentes/\x27||im.imagen_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20over\x20(partition\x20by\x20ca.file_id)\x20AS\x20ruta,\x0a\x20\x20\x20\x20\x20\x20\x20\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27[]\x27::jsonb\x20AS\x20ruta\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,ca.children\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20case\x20when\x20pa.captura_id\x20is\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20pa.cant_paginas\x20end\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20p.plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,count(ca.file_id)\x20over()\x20as\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20datos\x20ca\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20--left\x20join\x20imagen\x20im\x0a\x20\x20\x20\x20\x20\x20\x20\x20--on\x20\x20ca.captura_id\x20=\x20im.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20proyecto\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20p.proyecto_id\x20=\x20ca.proyecto_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_ruta_destino\x20gmrd\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmrd.captura_estado\x20=\x20ca.captura_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_detalle_captura\x20gmdc\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmdc.captura_id\x20=\x20ca.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_detalle\x20gmd\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--on\x20gmd.gmd_id\x20=\x2013--:gmd_id------------------------------------------------------------------------\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--on\x20gmd.gm_id\x20=\x20:gm_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmd.gmd_id\x20=\x20gmdc.gmd_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20paginas\x20pa\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pa.captura_id=gmdc.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20order\x20by\x20ca.file_id\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20--\x27visor/database/recepcion_\x27||(recepcion_id::varchar(10))||\x27.json\x27\x20as\x20file_data,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/recepcion_\x27||(recepcion_id::varchar(10))||\x27.json\x27\x20as\x20file_data,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20items,\x0a\x20\x20\x20\x20\x20\x20\x20\x20adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20--children,\x0a\x20\x20\x20\x20case\x0a\x20\x20\x20\x20\x20\x20\x20\x20when\x20ruta\x20=\x20\x27[null]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20\x27[]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ruta\x0a\x20\x20\x20\x20end\x20as\x20ruta\x0a\x20\x20\x20\x20\x20\x20\x20\x20,cant_paginas\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x27database/plantilla_\x27||(plantilla_id::varchar(10))||\x27.json\x27\x20as\x20plantilla_file\x0a\x20\x20\x20\x20\x20\x20\x20\x20,total\x0a\x20\x20\x20\x20from\x20datos2\x0a\x20\x20\x20\x20LIMIT\x20$2\x0a\x20\x20\x20\x20OFFSET\x20(($3-1)\x20*\x20$2)\x20\x0a\x20\x20\x20\x20;','contenidoFile':_0xa52ab4(0x1f1),'busquedaSimple':'\x0a\x20\x20\x20\x20with\x20recursive\x0a\x20\x20\x20\x20datos_input\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20$1::int\x20as\x20proyecto_id_input\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$2::int\x20as\x20recepcion_id_input\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$3::int\x20as\x20file_id_input\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$4\x20as\x20termino\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$5\x20as\x20carpeta\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$6\x20as\x20documento\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$7::boolean\x20as\x20indices\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$8::boolean\x20as\x20ocr\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$9::int\x20as\x20rowsxpag\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,$10::int\x20as\x20pag\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--separo\x20el\x20muestreo\x20de\x20files\x20que\x20esten\x20dentro\x20del\x20file\x20o\x20proyecto\x20seleccionado\x20en\x20el\x20input\x0a\x20\x20\x20\x20files_muestreo\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20f.*\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20datos_input\x20di\x0a\x20\x20\x20\x20\x20\x20\x20\x20cross\x20join\x20files\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20recepcion\x20r\x20on\x20r.recepcion_id\x20=\x20f.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x20f.file_id\x20=\x20di.file_id_input\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20or(\x20di.file_id_input=0\x20and\x20f.file_padre_id\x20is\x20null\x20and\x20f.file_captura_estado\x20=1\x20and\x20r.proyecto_id\x20=di.proyecto_id_input)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20union\x20all\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20f.*\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20files_muestreo\x20fm\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20files\x20f\x20on\x20f.file_padre_id\x20=\x20fm.file_id\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--hago\x20la\x20busqueda\x20solo\x20para\x20carpetas\x20usando\x20el\x20muestreo\x20previo\x0a\x20\x20\x20\x20busq_car\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20row_number()\x20over()\x20as\x20id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20di.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20false\x20as\x20coincidencia_contenido,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27\x27\x20as\x20pagina,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27\x27\x20as\x20linea,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27car\x27\x20as\x20tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x27\x27\x20as\x20coincidencia\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20*\x20from\x20datos_input\x20where\x20carpeta=\x27d\x27)\x20di\x0a\x20\x20\x20\x20\x20\x20\x20\x20cross\x20join\x20files_muestreo\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20--where\x20f.file_nombre\x20ilike\x20\x27%\x27||di.termino||\x27%\x27\x20and\x20f.file_tipo\x20=\x20\x27d\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20f.file_nombre\x20~*\x20di.termino\x20and\x20f.file_tipo\x20=\x20\x27d\x27\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--hago\x20la\x20busqueda\x20solo\x20para\x20documentos\x20usando\x20el\x20muestreo\x20previo\x0a\x20\x20\x20\x20busq_doc\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20row_number()\x20over()\x20as\x20id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20di.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20false\x20as\x20coincidencia_contenido,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27\x27\x20as\x20pagina,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27\x27\x20as\x20linea,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27doc\x27\x20as\x20tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x27\x27\x20as\x20coincidencia\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20*\x20from\x20datos_input\x20where\x20documento=\x27f\x27)\x20di\x0a\x20\x20\x20\x20\x20\x20\x20\x20cross\x20join\x20files_muestreo\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20--where\x20f.file_nombre\x20ilike\x20\x27%\x27||di.termino||\x27%\x27\x20and\x20f.file_tipo\x20=\x20\x27f\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20f.file_nombre\x20\x20~*\x20di.termino\x20and\x20f.file_tipo\x20=\x20\x27f\x27\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20,\x0a\x20\x20\x20\x20--hago\x20la\x20busqueda\x20solo\x20para\x20indices\x20usando\x20el\x20muestreo\x20previo\x0a\x20\x20\x20\x20busq_ind\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20row_number()\x20over()\x20as\x20id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20di.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20false\x20as\x20coincidencia_contenido,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27\x27\x20as\x20pagina,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27\x27\x20as\x20linea,\x0a\x20\x20\x20\x20\x20\x20\x20\x20--(case\x20when\x20r.elemento_tipo\x20=\x201\x20then\x20r.valor\x0a\x20\x20\x20\x20\x20\x20\x20\x20--\x09else\x20o.opcion_nombre\x20end)\x20as\x20linea,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27ind\x27\x20as\x20tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x27\x27\x20as\x20coincidencia\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20*\x20from\x20datos_input\x20where\x20indices\x20is\x20TRUE)\x20di\x0a\x20\x20\x20\x20\x20\x20\x20\x20cross\x20join\x20files_muestreo\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20captura\x20c\x20on\x20c.captura_file_id\x20=\x20f.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20indizacion\x20i\x20on\x20i.captura_id=\x20c.captura_id\x20and\x20i.indizacion_tipo\x20=\x20\x27VF\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20respuesta\x20r\x20on\x20r.indizacion_id\x20=\x20i.indizacion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20opcion\x20o\x20on\x20o.opcion_id\x20=\x20r.opcion_id\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(case\x20when\x20r.elemento_tipo\x20=\x201\x20then\x20r.valor\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--else\x20o.opcion_nombre\x20end)\x20ilike\x20\x27%\x27||di.termino||\x27%\x27\x20and\x20f.file_tipo\x20=\x20\x27f\x27\x09\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20o.opcion_nombre\x20end)\x20~*\x20di.termino\x20and\x20f.file_tipo\x20=\x20\x27f\x27\x09\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20busq_ocr\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20row_number()\x20over()\x20as\x20id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20f.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20di.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20true\x20as\x20coincidencia_contenido,\x0a\x20\x20\x20\x20\x20\x20\x20\x20doc.pagina::varchar\x20as\x20pagina,\x0a\x20\x20\x20\x20\x20\x20\x20\x20doc.texto\x20as\x20linea,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27ocr\x27\x20as\x20tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20,(regexp_matches(doc.texto,\x20di.termino,\x20\x27i\x27))[1]\x20as\x20coincidencia\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20*\x20from\x20datos_input\x20where\x20ocr\x20is\x20TRUE)\x20di\x0a\x20\x20\x20\x20\x20\x20\x20\x20cross\x20join\x20files_muestreo\x20f\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20captura\x20c\x20on\x20c.captura_file_id\x20=\x20f.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20join\x20documento_ocr\x20doc\x20on\x20doc.captura_id\x20=\x20c.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20--where\x20doc.texto\x20ilike\x20\x27%\x27||di.termino||\x27%\x27\x20and\x20f.file_tipo\x20=\x20\x27f\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20where\x20doc.texto\x20~*\x20di.termino\x20and\x20f.file_tipo\x20=\x20\x27f\x27\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--junto\x20todos\x20los\x20resultados\x0a\x20\x20\x20\x20files_r_pre\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20*\x20from\x20busq_car\x0a\x20\x20\x20\x20\x20\x20\x20\x20union\x20all\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20*\x20from\x20busq_doc\x0a\x20\x20\x20\x20\x20\x20\x20\x20union\x20all\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20*\x20from\x20busq_ind\x0a\x20\x20\x20\x20\x20\x20\x20\x20union\x20all\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20*\x20from\x20busq_ocr\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--filtro\x20solo\x20los\x20resultados\x20que\x20se\x20van\x20a\x20pintar\x20por\x20la\x20p√°ginacion\x0a\x20\x20\x20\x20files_r\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20,count(*)\x20over()\x20as\x20total\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20files_r_pre\x0a\x20\x20\x20\x20\x20\x20\x20\x20order\x20by\x20file_id,tipo_busqueda,id\x0a\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20(select\x20rowsxpag\x20from\x20datos_input)\x0a\x20\x20\x20\x20\x20\x20\x20\x20OFFSET\x20(((select\x20pag\x20from\x20datos_input)-1)\x20*\x20(select\x20rowsxpag\x20from\x20datos_input))\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20--consigo\x20la\x20cantidad\x20de\x20paginas\x20de\x20cada\x20documento\x0a\x20\x20\x20\x20paginas\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20c.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,c.captura_file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,count(b.imagen_id)\x20as\x20cant_paginas\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20files_r\x20a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20captura\x20c\x20on\x20c.captura_file_id\x20=\x20a.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20imagen\x20b\x20on\x20b.captura_id\x20=\x20c.captura_id\x20and\x20b.imagen_estado\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20group\x20by\x20c.captura_id,c.captura_file_id\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20cabecera\x20AS(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20--distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pro.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20re.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fi.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--fi.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20when\x20fi.file_captura_estado\x20!=\x201\x20then\x20fi.recepcion_id*-1000\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20fi.file_padre_id\x20end\x20as\x20file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20doc.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pla.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_url\x20,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ad.adetalle_peso\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,p.persona_nombre||\x27\x20\x27||p.persona_apellido\x20as\x20usuario_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,to_char(ca.created_at,\x27DD/MM/YYYY\x20-\x20HH24:MI:SS\x27)\x20as\x20created_at\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.coincidencia_contenido\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.pagina\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.linea\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,fi.total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,case\x20when\x20fi.tipo_busqueda=\x27ocr\x27\x20then\x20fi.coincidencia\x20else\x20fi.termino\x20end\x20as\x20termino\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20proyecto\x20pro\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20plantilla\x20pla\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pla.plantilla_id=\x20pro.plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20recepcion\x20re\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pro.proyecto_id=\x20re.proyecto_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--join\x20files_final\x20fi\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20join\x20files_r\x20fi\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20fi.recepcion_id\x20=\x20re.recepcion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20captura\x20\x20ca\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.captura_file_id\x20=\x20fi.file_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20documento\x20doc\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20doc.captura_id=\x20ca.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20adetalle\x20ad\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ad.adetalle_id\x20=\x20doc.adetalle_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--join\x20para\x20obtener\x20el\x20nombre\x20del\x20usuario\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20persona\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.usuario_creador\x20=\x20p.usuario_id\x0a\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos_pre\x20as\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20--distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20when\x20res.respuesta_id\x20is\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20json_build_object(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27respuesta_id\x27,\x20res.respuesta_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27opcion_id\x27,\x20res.opcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27combo_id\x27,\x20res.combo_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_id\x27,\x20res.elemento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_tipo\x27,\x20res.elemento_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27plantilla_id\x27,\x20res.plantilla_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27valor\x27,\x20res.valor,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27indizacion_id\x27,\x20res.indizacion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27conca_id\x27,\x20res.conca_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27simple_tipo_dato\x27,\x20s.simple_tipo_dato,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27simple_tipo_formato\x27,\x20s.simple_tipo_formato,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27elemento_nombre\x27,\x20e.elemento_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27opcion_nombre\x27,\x20o.opcion_nombre\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20end\x20as\x20item\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--over\x20(partition\x20by\x20ca.file_id)\x20AS\x20items\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--,ca.children\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.coincidencia_contenido\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.pagina\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.linea\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.total\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20,ca.termino\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20from\x20cabecera\x20ca\x20\x20left\x20join\x20indizacion\x20ind\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20ca.captura_id\x20=\x20ind.captura_id\x20and\x20ind.indizacion_tipo\x20=\x27VF\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20\x20respuesta\x20res\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20res.indizacion_id\x20=\x20ind.indizacion_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20elemento\x20e\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20e.elemento_id\x20=\x20res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20simple\x20s\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20s.elemento_id\x20=\x20res.elemento_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20opcion\x20o\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20o.opcion_id\x20=\x20res.opcion_id\x20\x20\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos\x20as(\x0a\x20\x20\x20\x20\x20\x20\x20\x20select\x20distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20jsonb_agg(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a.item\x0a\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20over(partition\x20by\x20a.file_id)\x0a\x20\x20\x20\x20\x20\x20\x20\x20as\x20items\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.coincidencia_contenido\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.pagina\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.linea\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.total\x0a\x20\x20\x20\x20\x20\x20\x20\x20,a.termino\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(select\x20*\x20from\x20datos_pre\x20order\x20by\x20file_id,tipo_busqueda,id,elemento_id)\x20a\x0a\x20\x20\x20\x20),\x0a\x20\x20\x20\x20datos2\x20as\x20(\x0a\x20\x20\x20\x20select\x20--distinct\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20case\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20when\x20ca.items\x20=\x20\x27[null]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20\x27[]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ca.items\x0a\x20\x20\x20\x20\x20\x20\x20\x20end\x20as\x20items,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27/\x27||gmd.gmd_nombre||\x27/\x27||gmrd.gmrd_ruta||ca.adetalle_nombre\x20as\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20-----\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/json/\x27||gmd.gmd_nombre||\x27/\x27||replace(ca.adetalle_nombre,\x27.pdf\x27,\x27.json\x27)\x20as\x20file_content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ca.adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27[]\x27::jsonb\x20AS\x20ruta\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,ca.children\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20case\x20when\x20pa.captura_id\x20is\x20null\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x200\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20pa.cant_paginas\x20end\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x20p.plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.total\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.coincidencia_contenido\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.pagina\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.linea\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20,ca.termino\x0a\x20\x20\x20\x20\x20\x20\x20\x20from\x20datos\x20ca\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20proyecto\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20p.proyecto_id\x20=\x20ca.proyecto_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_ruta_destino\x20gmrd\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmrd.captura_estado\x20=\x20ca.captura_estado\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_detalle_captura\x20gmdc\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmdc.captura_id\x20=\x20ca.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20generacion_medio_detalle\x20gmd\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20gmd.gmd_id\x20=\x20gmdc.gmd_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20left\x20join\x20paginas\x20pa\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20on\x20pa.captura_id=gmdc.captura_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20order\x20by\x20ca.file_id\x0a\x20\x20\x20\x20)\x0a\x20\x20\x20\x20select\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20proyecto_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20recepcion_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27database/recepcion_\x27||(recepcion_id::varchar(10))||\x27.json\x27\x20as\x20file_data,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_tipo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_padre_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20captura_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20captura_estado,\x0a\x20\x20\x20\x20\x20\x20\x20\x20documento_id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20plantilla_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20items,\x0a\x20\x20\x20\x20\x20\x20\x20\x20adetalle_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20file_name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20usuario_nombre,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20adetalle_peso,\x0a\x20\x20\x20\x20\x20\x20\x20\x20--children,\x0a\x20\x20\x20\x20case\x0a\x20\x20\x20\x20\x20\x20\x20\x20when\x20ruta\x20=\x20\x27[null]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20then\x20\x27[]\x27::jsonb\x0a\x20\x20\x20\x20\x20\x20\x20\x20else\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ruta\x0a\x20\x20\x20\x20end\x20as\x20ruta\x0a\x20\x20\x20\x20\x20\x20\x20\x20,cant_paginas\x0a\x20\x20\x20\x20\x20\x20\x20\x20--,plantilla_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,\x27database/plantilla_\x27||(plantilla_id::varchar(10))||\x27.json\x27\x20as\x20plantilla_file\x0a\x20\x20\x20\x20\x20\x20\x20\x20,total\x0a\x20\x20\x20\x20\x20\x20\x20\x20,id\x0a\x20\x20\x20\x20\x20\x20\x20\x20,coincidencia_contenido\x0a\x20\x20\x20\x20\x20\x20\x20\x20,pagina\x0a\x20\x20\x20\x20\x20\x20\x20\x20,linea\x0a\x20\x20\x20\x20\x20\x20\x20\x20,tipo_busqueda\x0a\x20\x20\x20\x20\x20\x20\x20\x20,termino\x0a\x20\x20\x20\x20from\x20datos2\x0a\x20\x20\x20\x20;\x0a\x20\x20\x20\x20','busquedaAvanzada':_0xa52ab4(0x1ea),'listarFilesContenido':_0xa52ab4(0x1fa)};